# Model predictive control of Ball and plate system
In this project:
------------------
Control of ball on plate using model predictive control with sequential quadratic programming and qpoases quadratic programming solver. 

To reduce solving time, the Condensing N2 is used to reduce number of variables from N*(Nx+Nu)+Nx to N*Nu. In addiction, the SQP just run one time to find the solution.

Motor controller:
	3 stepper motors with driven by 3 Tb6560 modules and a STM32H7 nucleo (microstep mode: 1/16):
	The timers 1,2,3 used as PWM sources and master timers.
	The timers 4.5.8 used as slave timers which return the number of pulses generated by timer 1,2,3. 
	The slave timers can count up or down depended on the setup of the 4th bit of TIMx->CR1. 
	The number of pulses generated will equivalent to TIMx-> CNT.
	In my project, I used it instead of encoder for motors.
	The serial com used a array of 9 char -> 3 target angle which received from host computer.
	The STM32H7 Nucleo with control the motor using PID control.
Fast model predictive control for nonlinear system:
	I have used many tools such as ACADO, Matlab MPC toolbox, MPT. However, I make this project because I like the MPC and I want to understand how exactly MPC works, also I want to make it myself.
	Fisrt, the system will be linearizated at the current points and generate 20 matrix of A, B in next 20 nodes:
		using classic Runge-Kutta method (RK4) to calculate next 20 variables of X.
		Calculate A(k), B(k), k=0,...,N-1
		saved
	Second: Caculate Gradient and Hessian Matrix: in the last project, I used a large number of variables: N*(Nx+Nu)+Nx, so the controller is slowed down and could not control the system. In this project, I used condensing N2 to reduce number of variables: N*Nu.
		From the result above ( A(k), B(k), X(k)) I calculated the Hessian and Gradient matrix with use the control variables u as the optimization variables.
		then, the qpoases used to solve the quadratic function with constrains
		last step: upload the u and apply the first u to system
The ball tracking with opencv is very simple so there is no discuss about it.
